!function(t){var e={};function s(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=t,s.c=e,s.d=function(t,e,o){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(o,r,function(e){return t[e]}.bind(null,r));return o},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){s(1),s(2),s(3),s(4),s(5),s(6),s(7),s(8),s(9),s(10),s(11),angular.module("app",["ngRoute","ui.router","appRoutes","Controller","DomainController","VulnController","SettingsController","DashboardController","ScansController","Domain","Integration","ngTable","toaster","Scans","chart.js","ui.bootstrap","ngAnimate"])},function(t,e){angular.module("Controller",[]).controller("Controller",["$scope","$state","$stateParams","$window","Domain","NgTableParams",function(t,e,s,o,r,n){this.domains=[],this.domain="",this.searchString="",this.type="domains",this.services=["PHP","Node.js","Ruby","Oracle HTTP Server","Java","jQuery UI","jQuery","Microsoft ASP.NET","IIS 8.5","Windows Server","Microsoft HTTPAPI 2.0","Apache","Microsoft SharePoint","Microsoft ASP.NET Viper","Modernizr","Twitter","IIS 7.5","ZURB Foundation","Google Tag Manager","Adobe Experience Manager","Plone","Python","F5 BigIP","animate.css","Bootstrap","prettyPhoto","OWL Carousel","Red Hat","Apache 2.2.15","Azure","Google Analytics","jQuery Migrate","DNN","Font Awesome","Hammer.js","Google Font API","Instabot","Amazon S3","Amazon Web Services"],this.fetchAll=()=>{var t={page:1,count:25},e=localStorage.getItem("tableParams-"+this.type);e&&(t=JSON.parse(e)),this.tableParams=new n(t,{filterDelay:1e3,getData:this.search})},this.search=e=>{var s={page:e.url().page,count:e.url().count,sorting:e.sorting(),filter:e.filter()};return localStorage.setItem("tableParams-"+this.type,JSON.stringify({count:e.url().count})),r.fetch(this.type,s).then(s=>{e.total(s.data.count);var o=s.data.rows;return t.count=s.data.count,o}).catch(t=>{console.log(t)})},this.add=function(){r.create(this.url).then(t=>{for(url of t.data)this.urls.unshift(url)}).catch(e=>{t.formError=e.data.message,console.log(e)})},this.clear=function(){this.tableParams.filter({}),this.tableParams.sorting({}),this.tableParams.url({})},this.delete=function(t){Url.delete(t).then(e=>{this.urls=this.urls.filter(e=>e.id!==t)}).catch(t=>{console.log(t)})}}]).filter("formatDate",()=>(function(t){return t.split(" ")[0]}))},function(t,e){angular.module("DashboardController",[]).controller("DashboardController",["$scope","$state","$stateParams","$window","Domain","NgTableParams",function(t,e,s,o,r,n){this.vulns=[],this.stats={},this.type="vulns",this.charts={severities:{data:[],labels:["Critical","High","Medium","Low","None"],colors:["#BB281A","#CE4A23","#EDA33B","#F7CB48","#6AA746"]},monthly:{data:[],labels:["Aug 2018","Sept 2018","Oct 2018","Nov 2018","Dec 2018","Jan 2019","Feb 2019","Mar 2019","Apr 2019","May 2019","June 2019","July 2019"],options:{responsive:!0,maintainAspectRatio:!1,elements:{line:{fill:!1}},scaleGridLineColor:"#CE4A23"},series:["Series 1"]},weaknesses:{data:[],labels:[],options:{responsive:!0,maintainAspectRatio:!1}},topDomains:{data:[],labels:[],options:{responsive:!0,maintainAspectRatio:!1}},topDomainsHigh:{data:[],labels:[],options:{responsive:!0,maintainAspectRatio:!1}}},this.globalChartOptionsLegend={responsive:!0,maintainAspectRatio:!1,legend:{display:!0}},this.fetchAll=()=>{var t=localStorage.getItem("vulns");t?(this.vulns=JSON.parse(t),this.computeStats()):r.fetch(this.type,{}).then(t=>{this.vulns=t.data,localStorage.setItem("vulns",JSON.stringify(this.vulns)),this.computeStats()}).catch(t=>{console.log(t)})},this.computeStats=()=>{var t={total:this.vulns.length,numOpen:0,severities:{critical:0,high:0,medium:0,low:0,none:0},topWeaknesses:{},commonDomains:{},rootDomains:{},rootDomainsHigh:{}};for(var e of this.vulns)if("open"==e.state&&t.numOpen++,t.severities[e.severity]+=1,e.weakness in t.topWeaknesses?t.topWeaknesses[e.weakness]+=1:t.topWeaknesses[e.weakness]=1,e.domains)for(var s of e.domains.split(",")){s in t.commonDomains?t.commonDomains[s]+=1:t.commonDomains[s]=1;var o=s.split("."),r=o[o.length-2]+"."+o[o.length-1];r in t.rootDomains?t.rootDomains[r]+=1:t.rootDomains[r]=1,"open"!=e.state||"high"!=e.severity&&"critical"!=e.severity||(r in t.rootDomainsHigh?t.rootDomainsHigh[r]+=1:t.rootDomainsHigh[r]=1)}t.commonDomains=this.toSortedArray(t.commonDomains),t.rootDomains=this.toSortedArray(t.rootDomains),t.rootDomainsHigh=this.toSortedArray(t.rootDomainsHigh),t.topWeaknesses=this.toSortedArray(t.topWeaknesses),console.log(t),this.stats=t,this.charts.severities.data=[this.stats.severities.critical,this.stats.severities.high,this.stats.severities.medium,this.stats.severities.low,this.stats.severities.none];var n=["2018-08","2018-09","2018-10","2018-11","2018-12","2019-01","2019-02","2019-03","2019-04","2019-05","2019-06","2019-07"],a=new Array(12).fill(0);for(var e of this.vulns)for(var i in n)e.reported_at.startsWith(n[i])&&a[i]++;this.charts.monthly.data=a,this.charts.topDomains.labels=this.stats.rootDomains.slice(0,10).map(t=>t[0]),this.charts.topDomains.data=this.stats.rootDomains.slice(0,10).map(t=>t[1]),this.charts.topDomainsHigh.labels=this.stats.rootDomainsHigh.slice(0,10).map(t=>t[0]),this.charts.topDomainsHigh.data=this.stats.rootDomainsHigh.slice(0,10).map(t=>t[1]),this.charts.weaknesses.labels=this.stats.topWeaknesses.slice(0,10).map(t=>t[0]),console.log(this.charts.weaknesses.labels),this.charts.weaknesses.data=this.stats.topWeaknesses.slice(0,10).map(t=>t[1]),console.log(this.charts.weaknesses.data)},this.toSortedArray=function(t){return Object.keys(t).map(e=>[e,t[e]]).sort((t,e)=>e[1]-t[1])},this.add=function(){r.create(this.url).then(t=>{for(url of t.data)this.urls.unshift(url)}).catch(e=>{t.formError=e.data.message,console.log(e)})},this.clear=function(){this.tableParams.filter({}),this.tableParams.sorting({}),this.tableParams.url({})},this.delete=function(t){Url.delete(t).then(e=>{this.urls=this.urls.filter(e=>e.id!==t)}).catch(t=>{console.log(t)})}}]).filter("formatDate",()=>(function(t){return t.split(" ")[0]}))},function(t,e){angular.module("SettingsController",[]).controller(["SettingsController",function(t,e,s,o,r,n,a){this.loadBDSources=function(){r.fetchBDSources().then(t=>{this.bdsources=t.data.searches}).catch(t=>{console.log(t)})},this.importBD=function(t){r.importBDSource(t).then(t=>{a.pop("success","Success",t.data.status)}).catch(t=>{console.log(t)})},this.importH1Contents=function(){r.importH1Contents(this.h1cookie).then(t=>{console.log(t)}).catch(t=>{console.log(t)})}}])},function(t,e){angular.module("DomainController",[]).controller("DomainController",["$scope","$state","$stateParams","$window","Domain","NgTableParams",function(t,e,s,o,r,n){this.domain={},this.fetch=()=>{r.fetchOne("domains",s.id).then(t=>{this.domain=t.data,this.domain.link=this.domain.ports.includes("443")?"https://"+this.domain.name:"http://"+this.domain.name}).catch(t=>{console.log(t)})}}])},function(t,e){angular.module("ScansController",[]).controller("ScansController",["$scope","$state","$stateParams","$window","Scans","NgTableParams","toaster",function(t,e,s,o,r,n,a){this.frequnit="minutes",this.commandArgs="",this.freq="",this.commandType="",t.tasks={},this.fetchLogs=function(){r.fetchLogs().then(t=>{logs=t.data.logs.split("\n").reverse(),""==logs[0]&&logs.shift(),this.logs=logs.join("\n")}).catch(t=>{a.pop("error","Error",t.data.error)})},this.initPortScan=function(){r.enqueueJob("scan-ports",[this.port]).then(t=>{a.pop("success","Success",t.data.status)}).catch(t=>{a.pop("error","Error",t.data.error)})},this.initHostScan=function(){r.enqueueJob("scan-hosts",[this.path]).then(t=>{a.pop("success","Success",t.data.status)}).catch(t=>{a.pop("error","Error",t.data.error)})},this.getConfig=function(){r.getConfig().then(t=>{this.jobs=t.data.jobs}).catch(t=>{a.pop("error","Error",t.data.error)})},this.scheduleCron=function(){r.scheduleCron({freq:this.freq,frequnit:this.frequnit,commandType:this.commandType,commandArgs:this.commandArgs}).then(t=>{this.jobs=t.data.jobs,a.pop("success","Success","Successfully added job")}).catch(t=>{console.log(t),a.pop("error","Error",t.data.error)})},this.removeCron=function(t){r.removeCron(t).then(t=>{this.jobs=t.data.jobs}).catch(t=>{a.pop("error","Error",t.data.error)})},this.pollRunningTasks=function(){this.getTasks("running"),this.getTasks("all"),setInterval(this.getRunningTasks,5e3)},this.getTasks=function(e){r.getTasksWithStatus(e).then(s=>{for(task of s.data)"running"==task.status?task.type="warning":"failed"==task.status?task.type="danger":"finished"==task.status&&(task.type="success"),task.status=task.status[0].toUpperCase()+task.status.substring(1);t.tasks[e]=s.data,console.log(t.tasks[e])}).catch(t=>{a.pop("error","Error",t.data.error)})},this.getAllTasks=function(){r.getTasksWithStatus("all").then(e=>{t.allTasks=e.data}).catch(t=>{a.pop("error","Error",t.data.error)})}}])},function(t,e){angular.module("VulnController",[]).controller("VulnController",["$scope","$state","$stateParams","$window","Domain","NgTableParams",function(t,e,s,o,r,n){this.vuln={},this.fetch=()=>{r.fetchOne("vulns",s.id).then(t=>{this.vuln=t.data}).catch(t=>{console.log(t)})}}])},function(t,e){angular.module("Domain",[]).service("Domain",["$http",function(t){this.create=function(e){return t.post("/api/domains",{domain:e})},this.fetch=function(e,s){return t.post("/api/"+e+"/search",s)},this.fetchOne=function(e,s){return t.get("/api/"+e+"/"+s)},this.search=function(e){return t.get("/api/domains/search?q="+encodeURIComponent(e))},this.delete=function(e){return t.delete("/api/domains/"+e)}}])},function(t,e){angular.module("Integration",[]).service("Integration",["$http",function(t){this.fetchBDSources=function(){return t.get("/api/bd/sources")},this.importBDSource=function(e){return t.post("/api/bd/sources/import",{id:e})},this.importH1Contents=function(e){return t.post("/api/h1/importContents",{cookie:e})}}])},function(t,e){angular.module("Scans",[]).service("Scans",["$http",function(t){this.fetchLogs=function(){return t.get("/api/scans/logs")},this.getConfig=function(){return t.get("/api/scans/configure")},this.getTasksWithStatus=function(e){return t.get("/api/tasks/"+e)},this.enqueueJob=function(e,s){return t.post("/api/scans/enqueue",{command:e,args:s})},this.scheduleCron=function(e){return t.post("/api/scans/configure",e)},this.removeCron=function(e){return t.post("/api/scans/remove",{index:e})}}])},function(t,e){},function(t,e){angular.module("appRoutes",[]).config(["$routeProvider","$locationProvider","$stateProvider",function(t,e,s){s.state("home",{url:"/",templateUrl:"views/home.html",controller:"Controller",controllerAs:"ctrl"}).state("settings",{url:"/settings",templateUrl:"views/settings.html",controller:"SettingsController",controllerAs:"ctrl"}).state("scans",{url:"/scans",templateUrl:"views/scans.html",controller:"ScansController",controllerAs:"ctrl"}).state("logs",{url:"/logs",templateUrl:"views/logs.html",controller:"ScansController",controllerAs:"ctrl"}).state("vulns",{url:"/vulns",templateUrl:"views/vulns.html",controller:"Controller",controllerAs:"ctrl"}).state("view-domain",{url:"/domain/:id",templateUrl:"views/domain.html",controller:"DomainController",controllerAs:"ctrl"}).state("view-vuln",{url:"/vuln/:id",templateUrl:"views/vuln.html",controller:"VulnController",controllerAs:"ctrl"}).state("dashboard",{url:"/dashboard",templateUrl:"views/dashboard.html",controller:"DashboardController",controllerAs:"ctrl"}).state("alerts",{url:"/alerts",templateUrl:"views/alerts.html",controller:"ScansController",controllerAs:"ctrl"}),e.html5Mode(!0)}])}]);